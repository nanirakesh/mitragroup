<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Details - Mitra</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <style>
        .detail-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .detail-card { border: none; box-shadow: 0 8px 25px rgba(0,0,0,0.1); border-radius: 15px; }
        .info-row { padding: 0.75rem 0; border-bottom: 1px solid #f0f0f0; }
        .info-row:last-child { border-bottom: none; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark detail-gradient">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/user/dashboard">
                <i class="fas fa-home me-2"></i>Mitra
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/user/dashboard"><i class="fas fa-tachometer-alt me-1"></i>Dashboard</a>
                <a class="nav-link" href="/user/requests"><i class="fas fa-list me-1"></i>My Requests</a>
                <a class="nav-link" href="/logout"><i class="fas fa-sign-out-alt me-1"></i>Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8">
                <div class="card detail-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Request Details</h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="info-row">
                            <div class="row align-items-center">
                                <div class="col-sm-4"><i class="fas fa-hashtag text-primary me-2"></i><strong>Request ID:</strong></div>
                                <div class="col-sm-8"><span class="badge bg-secondary" th:text="'#' + ${request.id}"></span></div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-3"><strong>Title:</strong></div>
                            <div class="col-sm-9" th:text="${request.title}"></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-3"><strong>Service Type:</strong></div>
                            <div class="col-sm-9" th:text="${request.serviceType}"></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-3"><strong>Description:</strong></div>
                            <div class="col-sm-9" th:text="${request.description}"></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-3"><strong>Priority:</strong></div>
                            <div class="col-sm-9">
                                <span class="badge" 
                                      th:classappend="${request.priority.name() == 'HIGH'} ? 'bg-danger' : 
                                                     (${request.priority.name() == 'MEDIUM'} ? 'bg-warning' : 'bg-info')"
                                      th:text="${request.priority}"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-3"><strong>Status:</strong></div>
                            <div class="col-sm-9">
                                <span class="badge" 
                                      th:classappend="${request.status.name() == 'COMPLETED'} ? 'bg-success' : 
                                                     (${request.status.name() == 'IN_PROGRESS'} ? 'bg-info' : 
                                                     (${request.status.name() == 'ASSIGNED'} ? 'bg-primary' : 'bg-secondary'))"
                                      th:text="${request.status}"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-3"><strong>Address:</strong></div>
                            <div class="col-sm-9" th:text="${request.address}"></div>
                        </div>
                        <div class="row mb-3" th:if="${request.city}">
                            <div class="col-sm-3"><strong>City:</strong></div>
                            <div class="col-sm-9" th:text="${request.city}"></div>
                        </div>
                        <div class="row mb-3" th:if="${request.phoneNumber}">
                            <div class="col-sm-3"><strong>Phone:</strong></div>
                            <div class="col-sm-9" th:text="${request.phoneNumber}"></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-3"><strong>Created:</strong></div>
                            <div class="col-sm-9" th:text="${#temporals.format(request.createdAt, 'MMM dd, yyyy HH:mm')}"></div>
                        </div>
                        <div class="row mb-3" th:if="${request.scheduledDate}">
                            <div class="col-sm-3"><strong>Scheduled:</strong></div>
                            <div class="col-sm-9" th:text="${#temporals.format(request.scheduledDate, 'MMM dd, yyyy HH:mm')}"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h6><i class="fas fa-user-tie"></i> Assigned Provider</h6>
                    </div>
                    <div class="card-body">
                        <div th:if="${request.assignedProvider != null}">
                            <p><strong>Name:</strong> <span th:text="${request.assignedProvider.name}"></span></p>
                            <p><strong>Phone:</strong> <span th:text="${request.assignedProvider.phone}"></span></p>
                            <p><strong>Skills:</strong> <span th:text="${request.assignedProvider.skills}"></span></p>
                            <button class="btn btn-success btn-sm">
                                <i class="fas fa-phone"></i> Call Provider
                            </button>
                        </div>
                        <div th:if="${request.assignedProvider == null}">
                            <p class="text-muted">No provider assigned yet</p>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h6><i class="fas fa-rupee-sign"></i> Cost Information</h6>
                    </div>
                    <div class="card-body">
                        <div th:if="${request.estimatedCost}">
                            <p><strong>Estimated Cost:</strong> ₹<span th:text="${request.estimatedCost}"></span></p>
                        </div>
                        <div th:if="${request.actualCost}">
                            <p><strong>Actual Cost:</strong> ₹<span th:text="${request.actualCost}"></span></p>
                        </div>
                        <div th:if="${request.estimatedCost == null && request.actualCost == null}">
                            <p class="text-muted">Cost will be estimated by provider</p>
                        </div>
                        <div th:if="${request.paymentStatus}">
                            <p><strong>Payment:</strong> 
                                <span class="badge" 
                                      th:classappend="${request.paymentStatus.name() == 'PAID'} ? 'bg-success' : 
                                                     (${request.paymentStatus.name() == 'FAILED'} ? 'bg-danger' : 'bg-warning')"
                                      th:text="${request.paymentStatus}"></span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h6><i class="fas fa-cog"></i> Actions</h6>
                    </div>
                    <div class="card-body">
                        <a href="/user/dashboard" class="btn btn-secondary btn-sm">
                            <i class="fas fa-arrow-left"></i> Back to Dashboard
                        </a>
                        <div th:if="${request.status.name() == 'IN_PROGRESS'}">
                            <button class="btn btn-info btn-sm mt-2">
                                <i class="fas fa-map-marker-alt"></i> Track Live
                            </button>
                        </div>
                        <div th:if="${request.status.name() == 'COMPLETED'}">
                            <button class="btn btn-warning btn-sm mt-2">
                                <i class="fas fa-star"></i> Rate Provider
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>